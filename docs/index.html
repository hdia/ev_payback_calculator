<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EV Payback Calculator (Australia)</title>

  <link rel="stylesheet" href="style.css" />

  <!-- PyScript -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
  <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="container">
      <div class="brand">
        <div class="brand-title">EV Payback Calculator</div>
        <div class="brand-sub">Australia-focused running-cost payback tool (energy + servicing). Built to match the Conversation article defaults.</div>
      </div>
      <div class="top-actions">
        <button id="btn-share" class="btn btn-ghost">Copy share link</button>
        <button id="btn-reset" class="btn btn-ghost">Reset</button>
      </div>
    </div>
  </header>

  <main class="container grid">
    <!-- Left: Inputs -->
    <section class="card">
      <h2>Inputs</h2>

      <div class="field">
        <label for="pair">Vehicle pair</label>
        <select id="pair"></select>
        <p class="hint">Choose one of the five matched EV vs petrol/hybrid pairs used in the article.</p>
      </div>

      <div class="field">
        <label for="km">Annual kilometres</label>
        <div class="row">
          <input id="km" type="number" min="0" step="500" value="15000" />
          <span class="unit">km/year</span>
        </div>
        <input id="km-slider" type="range" min="0" max="40000" step="500" value="15000" />
      </div>

      <div class="field">
        <label for="home-share">Home charging share</label>
        <div class="row">
          <input id="home-share" type="number" min="0" max="100" step="5" value="80" />
          <span class="unit">%</span>
        </div>
        <input id="home-share-slider" type="range" min="0" max="100" step="5" value="80" />
        <p class="hint">The rest is assumed to be public fast charging.</p>
      </div>

      <div class="field two-col">
        <div>
          <label for="home-price">Home electricity price</label>
          <div class="row">
            <input id="home-price" type="number" min="0" step="1" value="30" />
            <span class="unit">c/kWh</span>
          </div>
        </div>
        <div>
          <label for="public-price">Public fast charging price</label>
          <div class="row">
            <input id="public-price" type="number" min="0" step="1" value="55" />
            <span class="unit">c/kWh</span>
          </div>
        </div>
      </div>

      <div class="field">
        <label for="petrol">Petrol price</label>
        <div class="row">
          <input id="petrol" type="number" min="0" step="0.01" value="1.85" />
          <span class="unit">$/L</span>
        </div>
      </div>

      <div class="field two-col">
        <div>
          <label for="losses">Charging losses</label>
          <div class="row">
            <input id="losses" type="number" min="0" max="30" step="1" value="10" />
            <span class="unit">%</span>
          </div>
          <p class="hint">Baseline includes 10% charging losses (as per article).</p>
        </div>

        <div>
          <label for="maint">EV servicing saving</label>
          <div class="row">
            <input id="maint" type="number" min="-1000" max="2000" step="10" value="150" />
            <span class="unit">$/year</span>
          </div>
          <p class="hint">Conservative default: EV costs $150/year less to service.</p>
        </div>
      </div>

      <div class="field">
        <label class="checkbox">
          <input id="rw-toggle" type="checkbox" />
          Apply real-world adjustment (EV +10%, ICE +15%)
        </label>
        <p class="hint">This is optional and does not change the article tables (defaults use official label figures).</p>
      </div>

      <div class="actions">
        <button id="btn-copy" class="btn">Copy summary</button>
      </div>

      <div class="divider"></div>

      <details class="accordion" open>
        <summary>What this tool includes (and excludes)</summary>
        <div class="accordion-body">
          <p><strong>Includes:</strong> energy costs (electricity vs petrol) and a conservative servicing difference.</p>
          <p><strong>Excludes:</strong> resale value, depreciation, insurance, finance costs, registration discounts, and rebates.</p>
          <p>Figures are indicative, and depend heavily on charging access and energy prices.</p>
        </div>
      </details>
    </section>

    <!-- Right: Outputs -->
    <section class="card">
      <h2>Results</h2>

      <div class="kpi-grid">
        <div class="kpi">
          <div class="kpi-label">Payback time</div>
          <div class="kpi-value" id="kpi-payback">–</div>
          <div class="kpi-sub" id="kpi-payback-sub">–</div>
        </div>

        <div class="kpi">
          <div class="kpi-label">Annual savings</div>
          <div class="kpi-value" id="kpi-annual">–</div>
          <div class="kpi-sub" id="kpi-annual-sub">–</div>
        </div>

        <div class="kpi">
          <div class="kpi-label">Savings per 100 km</div>
          <div class="kpi-value" id="kpi-per100">–</div>
          <div class="kpi-sub" id="kpi-per100-sub">–</div>
        </div>
      </div>

      <div class="summary" id="summary">–</div>

      <div class="chart-block">
        <h3>How payback changes with home charging</h3>
        <div id="chart-payback" class="chart"></div>
        <p class="hint">Holding prices and kilometres constant, this shows why charging behaviour can dominate the payback outcome.</p>
      </div>

      <div class="chart-block">
        <h3>Cumulative net savings over time</h3>
        <div id="chart-cumulative" class="chart"></div>
        <p class="hint">Net savings are shown relative to paying the upfront premium today (running costs only).</p>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <p>
        Built by Swinburne University of Technology. Data inputs based on Australian label figures (ADR 81/02) and transparent baseline energy prices.
      </p>
    </div>
  </footer>

  <script type="py" src="app.py"></script>
</body>
</html>
